{% import "admin/base/base_macros.html" as base with context %}
{% import "admin/base/macros/pro_macros.html" as pro_macro with context %}


        <!-- form start -->
        <form id="form_publish" data-pjax action="{{ reverse_url('apply.service.publish.add') }}" class="form-horizontal" method="POST">
        {{ handler.xsrf_form_html() }}
          <input type="hidden" name="pro_id" value="{{ pro_info_res.data.id }}">
          <div class="box-body">
          {% if publish_res %}
          {% set data = publish_res.data %}
          {% set ST = STATUS_PRO_TABLES.get(data.status) %}
          {% if data %}
          {{ base.tip_message(message="您{}的互联网发布内容{}，{}。".format(ST.act_value, ST.value, ST.todo_value), level=ST.level) }}
          {% endif %}
          {% else %}
          {% set data = {} %}
          {% endif %}
          {% if handler.request.method == "POST" %}
            {% set domain = handler.args.get("domain", "") %}
            {% set domain_port = handler.args.get("domain_port", "") %}
            {% set network_address = handler.args.get("network_address", "") %}
            {% set network_port = handler.args.get("network_port", "") %}
            {% set use_ssl = handler.args.get("use_ssl", "-1")|string %}
            {% set status = handler.args.get("status", "0")|int %}
          {% else %}
            {% set domain = data.domain if data else "" %}
            {% set domain_port = data.domain_port if data else "" %}
            {% set network_address = data.network_address if data else "" %}
            {% set network_port = data.network_port if data else "" %}
            {% set use_ssl = data.use_ssl|string if data else "" %}
            {% set status = data.status|int if data else "" %}
          {% endif %}
          {{ pro_macro.get_pro_info_select() }}
          {{ base.form_input("域名", "domain", res=publish_res, value=domain,
                check_codes=[ERR.PRO_PUBLISH_DOMAIN_EMPTY_ERR, ERR.PRO_PUBLISH_DOMAIN_INVALID_ERR]) }}
          {{ base.form_input("互联网端口", "domain_port", res=publish_res, value=domain_port,
                check_codes=[ERR.PRO_PUBLISH_DOMAIN_PORT_EMPTY_ERR, ERR.PRO_PUBLISH_DOMAIN_PORT_INVALID_ERR]) }}
          {{ base.form_input("内网地址", "network_address", res=publish_res, value=network_address,
                check_codes=[ERR.PRO_PUBLISH_NETWORK_ADDRESS_EMPTY_ERR, ERR.PRO_PUBLISH_NETWORK_ADDRESS_INVALID_ERR]) }}
          {{ base.form_input("内网端口", "network_port", res=publish_res, value=network_port,
                check_codes=[ERR.PRO_PUBLISH_NETWORK_PORT_EMPTY_ERR, ERR.PRO_PUBLISH_NETWORK_PORT_INVALID_ERR]) }}
            <div class="form-group">
              <label for="loadbalance" class="col-sm-2 control-label">SSL卸载</label>
              <div class="radio col-sm-offset-2 col-sm-10">
                  <label>
                  <input type="radio" name="use_ssl" id="use_ssl" value="1"{% if use_ssl|int == 1 %} checked="checked"{% endif %}>
                    需要
                  </label>
              </div>
              <div class="radio col-sm-offset-2 col-sm-10">
                  <label>
                    <input type="radio" name="use_ssl" id="use_ssl" value="0"{% if use_ssl|int == 0 %} checked="checked"{% endif %}>
                    不需要
                  </label>
              </div>
            </div>
          </div>
          <div class="box-footer text-center">
            {% if not data %}
            <button type="button" id="form_publish_btn" onclick="do_form_publish()" class="btn btn-warning">提 交</button>
            {% elif data.status <= STATUS_PRO_TABLES.REVOKED %}
            <button type="button" id="form_publish_btn" onclick="do_form_publish()" class="btn btn-warning">提 交</button>
            {% elif data.status == STATUS_PRO_TABLES.APPLIED %}
            <button type="button" id="form_publish_btn" onclick="javascript:;" class="btn btn-info">受理中</button>
            {% elif data.status == STATUS_PRO_TABLES.CHECKED %}
            <button type="button" id="form_publish_btn" onclick="pro_table_do_confirm({_this: this, pro_table: 'pro_publish', ids: [{{ data.id }}]})" class="btn btn-warning">确 认</button>
            {% elif data.status == STATUS_PRO_TABLES.CONFIRMED %}
            <button type="button" id="form_publish_btn" onclick="javascript:;" class="btn btn-warning">已确认</button>
            <button type="button" id="form_publish_btn" onclick="do_form_publish()" class="btn btn-warning">重 新 提 交</button>
            {% endif %}
          </div><!-- /.box-footer -->
        </form>

<script type="text/javascript">
  function do_form_publish(){
    generate_ajax_post({
        form: "#form_publish",
        button: "#form_publish_btn",
        pjax_container: false,
        onSuccess: function(response){
            $("section.content").prepend(response.data.messages_tmpl);
            $("#form_publish").parent().html(response.data.tmpl);
        },
        onTimeout: function(){ do_add_pro_user();}
    })
  }
  $(function () {
    //Add text editor
    $("#content").wysihtml5();
  });
</script>
