{% import "admin/base/base_macros.html" as base with context %}
{% import "admin/base/macros/pro_macros.html" as pro_macro with context %}

      <!-- Horizontal Form -->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">添加新用户</h3>
          {#
          <div class="pull-right box-tools">
            <a data-pjax href="{{ reverse_url('apply.user.add') }}" class="btn btn-sm btn-default"><i class="fa fa-refresh"></i></a>
            <button class="btn btn-info btn-sm" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="fa fa-times"></i></button>
          </div><!-- /. tools -->
          #}
        </div><!-- /.box-header -->
        <!-- form start -->
        <form data-pjax id="event_form" class="form-horizontal" action="{{ reverse_url('event.add') }}">
          {{ handler.xsrf_form_html() }}
          {% if handler.request.method == "POST" %}
              {% set username = handler.args.get("username", "") %}
              {% set email = handler.args.get("email", "") %}
              {% set is_enable = handler.args.get("is_enable", "") %}
              {% set use_vpn = handler.args.get("use_vpn", "") %}
          {% else %}
              {% set username = handler.args.get("username", "") %}
              {% set email = handler.args.get("email", "") %}
              {% set is_enable = handler.args.get("is_enable", "") %}
              {% set use_vpn = handler.args.get("use_vpn", "") %}
          {% endif %}
          <input type="hidden" id="res_apply_id" name="res_apply_id" value="{{ res_apply_id }}"/>
          <div class="box-body">
            {{ pro_macro.get_pro_info_select() }}
            {{ base.form_input("用户名", "username", right_col=6, value=username, res=do_event_res, check_codes=[ERR.USERNAME_EMPTY_ERR, ERR.USERNAME_DUPLICATE_ERR]) }}
            {{ base.form_input("邮箱", "email", right_col=6, res=pro_user_res, value=email,
              check_codes=[ERR.EMAIL_EMPTY_ERR, ERR.EMAIL_FORMAT_ERR, ERR.EMAIL_DUPLICATE_ERR]) }}
            {{ base.form_select("是否有效", "is_enable", value=is_enable, options=[{"value": 1, "desc": "是"}, {"value":0, "desc": "否"}], res=pro_user_res) }}
            <div class="form-group">
              <div class="radio col-sm-offset-2 col-sm-10">
                  <label>
                  <input type="radio" name="use_vpn" id="use_vpn" value="1"{% if use_vpn|int == 1 %} checked="checked"{% endif %}>
                    需要为此用户开通VPN远程访问，并接受用户安全协议。<a href="#">查看协议</a>
                  </label>
              </div>
              <div class="radio col-sm-offset-2 col-sm-10">
                  <label>
                  <input type="radio" name="use_vpn" id="use_vpn" value="0"{% if use_vpn|int == 0 %} checked="checked"{% endif %}>
                    不需开通VPN，管理员于操作间使用资源
                  </label>
              </div>
            </div>
          </div><!-- /.box-body -->
          <div class="box-footer text-center">
            <button type="button" id="event_form_btn" onclick="do_add_env()" class="btn btn-info">提 交</button>
          </div><!-- /.box-footer -->
        </form>
      </div><!-- /.box -->
    
<script text="text/javascript">
  function formatPro(state){
    if (!state.id) { return state.text; }
    var res_apply_id = $(state.element).attr("res_apply_id");
    var status_bg_color = $(state.element).attr("status_bg_color");
    var status_value = $(state.element).attr("status_value");
    var status_disabled = $(state.element).attr("disabled");
    if (status_disabled == "disabled"){
      var disabled_text = "<span class='badge'>不可选</span>";
    }else{
      var disabled_text = "";
    }
    var $state = $("<span>" + state.text + " <span class='badge bg-"+status_bg_color+"'>"+status_value+"</span> " + disabled_text + "</span>");
    return $state;
  }
  $("select").select2();
  $("select[name=pro_id]").select2({
      templateResult: formatPro,
      templateSelection: formatPro
  });
  function do_add_env(){
    generate_ajax_post({
        form: "#event_form",
        button: "#event_form_btn",
        onTimeout: function(){ do_add_env();}
    })
  }
</script>
        <script type="text/javascript">
          $(function () {
            //Add text editor
            $("#content").wysihtml5();
          });
        </script>